<!DOCTYPE	html>	
<html>	
	<head>	
			<link	rel="stylesheet"	href="http://localhost/mobile_web/jquery.mobile-1.4.4/jquery.mobile-1.4.4.min.css">	
			<script	src="http://localhost/mobile_web/jquery-1.11.1.min.js"></script>	
			<script	src="http://localhost/mobile_web/jquery.mobile-1.4.4/jquery.mobile-1.4.4.min.js"></script>
			
			<script>	
				//makes a synchronous call to the page u and return the result as object
				function syncAjax(u){
						var obj=$.ajax(
							{url:u,
							 async:false
							 }
						);
						console.log(obj.responseText)
						return $.parseJSON(obj.responseText);	
				}
				
				
				var datet;
					/** rmakes an ajax call to the database , returns the trip details and 
					          displays it in the html body below**/
					$(document).on("pageshow", function(event, data) {
					$id=1;
					var u="http://localhost/mobile_web/ash_transit/ash_transit_action.php?cmd=1&n="+$id;					
					console.log(u);
					r=syncAjax(u);
					var name = r.trip.trip_name;
					var datet = r.trip.date
					$('#date').html(datet);
					$('#trip_name').val(name);
					$('#departure_time').val(r.trip.departure_time);
					$('#current_location').val(r.trip.current_location);
					$('#seats').val(r.trip.available_seats);
					
					if (name == "Christ the King-Ashesi"){
					var u="http://localhost/mobile_web/ash_transit/ash_transit_action.php?cmd=2";					
					console.log(u);
					r=syncAjax(u);
					var table ="<table border='0'  cellspacing='5' width='100%'><tr><td><b>Transit Location</b></td><td><b>Time</b></td></tr>";
					for(var i=0;i<r.morning_transit_details.length;i++){
					table+="<tr><td>"+r.morning_transit_details[i].transit_location +"</td><td>"+r.morning_transit_details[i].setTime +"</td><tr>";
					}
					table +="</table>";
					if(document.getElementById("transitTable")==null){
						console.log("Not yet initialized");
					}
					else {
					document.getElementById("transitTable").innerHTML=table;
						}
					}
					
					if(name == "Ashesi-Christ the King"){
						var u="http://localhost/mobile_web/ash_transit/ash_transit_action.php?cmd=3";					
					console.log(u);
					r=syncAjax(u);
					var table ="<table border='0'  cellspacing='5' width='100%'><tr><td><b>Transit Location</b></td><td><b>Time</b></td></tr>";
					for(var i=0;i<r.Afternoon_transit_details.length;i++){
					table+="<tr><td>"+r.Afternoon_transit_details[i].transit_location +"</td><td>"+r.Afternoon_transit_details[i].set_time +"</td><tr>";
					}
					table +="</table>";
					if(document.getElementById("transitTable")==null){
						console.log("Not yet initialized");
					}
					else {
					document.getElementById("transitTable").innerHTML=table;
						}
					}
				});
				
				var name="";
					var phone="";
					var id="";
				$(document).ready(function(){
					$("#book").click(function(){
						var mdate=document.getElementById("tdate").value;
						var mtname=document.getElementById("tname").value;
						var mpname=document.getElementById("pname").value;
						var mpid=document.getElementById("pid").value;
						var mpno=document.getElementById("pno").value;
						var mpick_up=document.getElementById("pickup").value;
					
						var u="http://localhost/mobile_web/ash_transit/ash_transit_action.php?cmd=5&pname="+mpname+"&myashid="+mpid+"&pnumber="+mpno+"&tName="+mtname+"&pick_up="+mpick_up+"&mydate="+mdate;
						console.log(u);
						r=syncAjax(u);
						$("#statusreserve").fadeTo(500, 1, function() { $(this).html("Reservation was successful").fadeTo(7000, 0, function() { location.href='#homepage'} ); })
						
					});
				});
				
				function login(){
				
						var myashid=document.getElementById("myashid").value;
						var mypword=document.getElementById("mypword").value;
						var u="http://localhost/mobile_web/ash_transit/ash_transit_action.php?cmd=4&myashid="+myashid+"&mypword="+mypword;
						console.log(u);
						r=syncAjax(u);
						
						var id=r.User.Ashesi_Id;
						var name=r.User.name;
						var phone=r.User.phone_number;
						var myrole=r.User.role;
						var mypassword=r.User.password;
					
					if (myashid == id && mypword == mypassword && myrole == "Passenger") {
						$("#status").fadeTo(500,1, function() { $(this).html("Success! Loading Passenger's Page...").fadeTo(5000,0,function() {location.href="#reservation"}); })
						$("#myashid").val("");
						 $("#mypword").val("");
					}
					//Message displayed if username or password is not correct
					else{
						$("#status").fadeTo(500,1, function() { $(this).html("Invalid username or password").fadeTo(5000,0,function() {location.href="#this"}); })
						$("#myashid").val("");
						 $("#mypword").val("");
					}
						 $("#pname").val(name);
						 $("#pid").val(id);
						 $("#pno").val(phone);
						 $id=1;
						var u="http://localhost/mobile_web/ash_transit/ash_transit_action.php?cmd=1&n="+$id;					
						console.log(u);
						r=syncAjax(u);
						var name = r.trip.trip_name;
						var datet = r.trip.date
						 $("#tname").val(name);
						 $("#tdate").val(datet);
				}
					
    </script>
	</head>	

	<body >	
		<!-- This page contains jquery codes that display trip details -->
		<div data-role="page" id="homepage" >	
		<!-- This is an header for the page -->
		<div data-role="header" data-position="fixed">		
				<h1>ASH TRANSPORTER</h1>
				<div data-role="navbar" data-position="fixed">
					<ul><li><a href="#" data-transition="slide" data-icon="home" data-iconpos="left">Trip Details</a></li></ul>
				</div>
		</div>
		<!-- the main body, where the trip details are displayed, using input boxes and labels-->
		<div data-role="main" class="ui-content">
				<div data-role="collapsible">
				<h4>View Trip details and book a seat</h4>
				<div  id="date" align="right"></div>
				<div><label for="name">Trip Name</label><input type="text" id="trip_name"  readonly></div>
				<div><label for="departure_time">Departure Time</label><input type="text" id="departure_time" readonly></div>
				<div ><label for="lblnext">Number of seats Available</label><input type="text" id="seats"  readonly></div>
				<div ><a href="#login" data-role="button">Click to Reserve a seat</a></div>
				</div>
				<div data-role="collapsible">
				<h4>Bus current location and transit details</h4>
				<div> <label for="lblcur">The bus is currently at</label><input type="text" id="current_location"  readonly></div>
				<div id="transitTable"></div>
				</div>
		</div>	
		<!-- This is a footer -->
			<div data-role="footer" data-position="fixed" >	
					<h1>Droid-Ventors@AshSoftEng2014</h1>
			</div>	
		</div>
		
		
		<div data-role="page" id="login">	
		<!-- This is an header for the page -->
		<div data-role="header" data-position="fixed">		
				<h1>ASH TRANSPORTER</h1>
				<div data-role="navbar" data-position="fixed">
					<ul><li><a href="#" data-transition="slide" data-icon="home" data-iconpos="left">User login</a></li></ul>
				</div>
		</div>
		<!-- the main body, where the trip details are displayed, using input boxes and labels-->
		<div data-role="main" class="ui-content">
				<div  id="date" align="right"></div>
				<div><label for="aid">Ashesi ID</label><input type="text" id="myashid" ></div>
				<div><label for="ap">Password</label><input type="text" id="mypword" ></div>
				<div><input type="button" id="login" value="Login" onclick="login()"></div>
				<div id="status" style="color:#FF0000" align="center"> </div>
		</div>	
		<!-- This is a footer -->
			<div data-role="footer" data-position="fixed" >	
					<h1>Droid-Ventors@AshSoftEng2014</h1>
			</div>	
		</div>
		
		<div data-role="page" id="reservation">	
		<!-- This is an header for the page -->
		<div data-role="header" data-position="fixed">		
				<h1>ASH TRANSPORTER</h1>
				<div data-role="navbar" data-position="fixed">
					<ul><li><a href="#" data-transition="slide" data-icon="home" data-iconpos="left">User login</a></li></ul>
				</div>
		</div>
		<!-- the main body, where the trip details are displayed, using input boxes and labels-->
		<div data-role="main" class="ui-content">
				<div> <label for="ap">Trip Date</label><input type="text" id="tdate" readonly></div>
				<div> <label for="ap">Trip Name</label><input type="text" id="tname" readonly></div>
				<table><tr><td>
				<div><label for="aid">Passenger Name</label><input type="text" id="pname" readonly></div>
				</td><td>
				<div> <label for="ap">phone Number</label><input type="text" id="pno" readonly></div>
				</td></tr>
				<tr><td>
				<div> <label for="ap">Pay Via Ashesi ID</label><input type="text" id="pid" readonly></div>
				</td><td>
				<div>
				<label for="day">Select Pick up Location</label>
					<select name="pickup" id="pickup">
					<option value="ctk">Christ the King</option>
					<option value="37">37</option>
					<option value="mall">Accra Mall</option>
					<option value="legon">Legon</option>
					<option value="atomic">Atomic Round About</option>
					<option value="kwabenya">Kwabenya</option>
					<option value="abom">Abom Junction</option>
					<option value="comet">Comet</option>
					<option value="berekuso">Berekuso</option>
					<option value="ashesi">Ashesi</option>
				</select>
				</div>
				</td></tr><table>
				<div><input type="button" id="book" value="Reserve Seat"></div>
				<div id="statusreserve" style="color:#FF0000" align="center"> </div>
		</div>	
		<!-- This is a footer -->
			<div data-role="footer" data-position="fixed" >	
					<h1>Droid-Ventors@AshSoftEng2014</h1>
			</div>	
		</div>
		
		
	</body>	
</html>	