<html>
	<head>
		<link rel="stylesheet" href='jquery.mobile-1.4.4.min.css'>
		<script type="text/javascript" src="jquery-1.11.1.min.js"></script>
		<script type="text/javascript" src='jquery.mobile-1.4.4.min.js'></script>

	<script>

		// syncAjax Function
		function syncAjax(u){
		console.log(u);
			var obj=$.ajax(
				{url:u,
				 async:false
				 }
			);
			console.log(obj.responseText);
			return $.parseJSON(obj.responseText);
			
		}

		function changeConductor(){
		
			var idd=$("#select-conductor").val();	
			var u="index_json_response.php?cmd=5&id="+idd;
			var r=syncAjax(u);
            console.log(r);
			//location.reload();
		}
			

		$(document).ready(function(){

			// Login Function
			$("#login").click(function(){
			var dbname="";
			var dbcode="";
			var name1=$('#username').val();
			var password1=$('#psword').val();
			var u ="index_json_response.php?cmd=1&name="+name1+"&password="+password1;
			r=syncAjax(u);

			var nm = "";
			var pword = "";
			var rle = "";

			//Conditions for loading the different pages after successful login depending on the role of the user

			if (name1 == r.users.name1 && password1 == r.users.password1 && r.users.role1 == "passenger") {
				$("#status").fadeTo(500,1, function() { $(this).html("Success! Loading Passenger's Page...").fadeTo(5000,0,function() {location.href="#passpage"}); })
			}

			else if (name1 == r.users.name1 && password1 == r.users.password1 && r.users.role1 == "conductor") {
				$("#status").fadeTo(500,1, function() { $(this).html("Success! Loading Conductor's Page...").fadeTo(5000,0,function() {location.href="#conpage"}); })
			}

			else if (name1 == r.users.name1 && password1 == r.users.password1 && r.users.role1 == "manager") {
				$("#status").fadeTo(500,1, function() { $(this).html("Success! Loading Manager's Page...").fadeTo(5000,0,function() {location.href="manager.html"}); })
			}

			//Message displayed if username or password is not correct
			else {
				$("#status").fadeTo(500,1, function() { $(this).html("Invalid username or password"); })
			}

			});

		   //get current report
			  $("#getCurReport").click(function(){
			 r=syncAjax("index_json_response.php?cmd=2");
			 for (var i = 0; i < r.myashtrans.length; i++)
			 {
			   var part = "<br>Trip Name: " + r.myashtrans[i].t_name + "<br>Departure Time: " + r.myashtrans[i].setDepartureTime + "<br>Capacity: " + r.myashtrans[i].adminCapacity + "<br>Reservations: " + r.myashtrans[i].numPeopleReserved;
			   $('<p>'+ part + '</p>').appendTo($('#cur_rep'));
			 }
			 this.disabled = true;
			 });

			//get all reports
			  $("#getReports").click(function(){
			 r=syncAjax("index_json_response.php?cmd=3");
			 for (var i = 0; i < r.myashtrans.length; i++)
			 {
			   var part ="Date:" + r.myashtrans[i].t_date + "<br>Trip Name: " + r.myashtrans[i].t_name + "<br>Departure Time: " + r.myashtrans[i].setDepartureTime + "<br>Capacity: " + r.myashtrans[i].adminCapacity + "<br>Reservations: " + r.myashtrans[i].numPeopleReserved;
			   $('<p>'+ part + '</p>').appendTo($('#reps'));
			 }
			 this.disabled = true;
			 });

			//get reservations
			  $("#getReservations").click(function(){
			 r=syncAjax("index_json_response.php?cmd=4");
			 for (var i = 0; i < r.myashtrans.length; i++)
			 {
			   var part = "Date:" + r.myashtrans[i].t_date + "<br>Name: " + r.myashtrans[i].name + " [" + r.myashtrans[i].ash_id + "]" + "<br>Trip: " + r.myashtrans[i].t_name + "<br>Pick Up Point: " + r.myashtrans[i].destination + "<br>Seat: #" + r.myashtrans[i].seat_no;
			   $('<p>'+ part + '</p>').appendTo($('#reserves'));
			 }
			 this.disabled = true;
			 });

		});
		</script>

	</head>


	<body>

		<!--Log In Page-->
		<div data-role="page" id="loginpage" data-theme="b">
			<div data-role="header">
				<div data-role="navbar">
					<ul>
						<h1 align="center">Ash-Transit</h1>
					</ul>
				</div>
			</div>

				<div role="main" class="ui-content" align="center"> 
				
					<img src="bustransit.png" width="300" height="150"/>

					<p style='font-size:100%'>Login To Begin</p>

					<!-- Login form -->
					<input type="text" id="username" placeholder="username">
					<input type="password" id="psword" placeholder="******">

					<input type="button" id="login" value="Login">

					<div id="status" style="color:#FF0000" align="center"></div>
				</div>

			<div data-role="footer">
				<div data-role="navbar">
					<ul>
						<h2 align="center">Developed By: Droid-Ventors</h2>
					</ul>
				</div>
			</div>
		</div>


		<!--Manager's Page-->
		<div data-role="page" id="manpage" data-theme="b">
			<div data-role="header">
				<div data-role="navbar">
					<ul>
						<h1 align="center">Ash-Transit</h1>
					</ul>
				</div>
			</div>

				<div role="main" class="ui-content" align="center">

					<div style="color:#FF0000" align="center">Manager's Page</div>

					<form>
	                        <div data-role="fieldcontain" align="center">
	                             <!-- <fieldset data-role="controlgroup"> -->
	                              
	                                 <!-- <label for="select-conductor">Select Conductor</label> -->
	                                 <select name="select-conductor" id="select-conductor">
	                                     <option>Select Conductor</option>
                                             <option value="1234">Anna Reimah</option>
                                             <option value="5678">Nina Pearls</option>
                                            
	                                    <!-- etc. -->
	                                 </select>
	                                 
	                            <!-- </fieldset> -->
	                        </div>

	                         <div align="center">
                                    <label for="submit" ></label>
                                    <input type="button" name="submit" value="Save" data-inline="true" onclick="changeConductor()"/>
	                         </div>
	                     </form>

					<div data-role="collapsible-set">
					<div data-role="collapsible">

						<h1>Today's Report</h1>
						<button id="getCurReport">Click To View Today's Report</button>
							<p id="cur_rep"></p> <br><br>

					</div><br>

					<div data-role="collapsible">
						
						<h1>All Reports</h1>
						<button id="getReports">Click To View All Reports</button>
							<p id="reps"></p> <br><br>

					</div><br>

					<div data-role="collapsible">
						
						<h1>List of All Reservations</h1>
						<button id="getReservations">Click To View Reservations</button>
							<p id="reserves"></p> <br><br>

					</div><br>
				</div>
				</div>

			<div data-role="footer">
				<div data-role="navbar">
					<ul>
						<h2 align="center">Developed By: Droid-Ventors</h2>
					</ul>
				</div>
			</div>
		</div>


		<!--Conductor's Page-->
		<div data-role="page" id="conpage" data-theme="b">
			<div data-role="header">
				<div data-role="navbar">
					<ul>
						<h1 align="center">Ash-Transit</h1>
					</ul>
				</div>
			</div>

				<div role="main" class="ui-content" align="center">

					<div style="color:#FF0000" align="center">Conductor's Page</div>

				</div>

			<div data-role="footer">
				<div data-role="navbar">
					<ul>
						<h2 align="center">Developed By: Droid-Ventors</h2>
					</ul>
				</div>
			</div>
		</div>


		<!--Passenger's Page-->
		<div data-role="page" id="passpage" data-theme="b">
			<div data-role="header">
				<div data-role="navbar">
					<ul>
						<h1 align="center">Ash-Transit</h1>
					</ul>
				</div>
			</div>

				<div role="main" class="ui-content" align="center">

					<div style="color:#FF0000" align="center">Passenger's Page</div>

				</div>

			<div data-role="footer">
				<div data-role="navbar">
					<ul>
						<h2 align="center">Developed By: Droid-Ventors</h2>
					</ul>
				</div>
			</div>
		</div>
	</body>
</html>