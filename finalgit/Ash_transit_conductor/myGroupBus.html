<!DOCTYPE html>
<html>
<head>
	<link	rel="stylesheet"	href="http://50.63.128.135/~csashesi/class2015/esi-yeenuwa/Ash_transit_conductor/jquery.mobile-1.4.4.min.css">	
			<script	src="http://50.63.128.135/~csashesi/class2015/esi-yeenuwa/Ash_transit_conductor/jquery-1.11.1.min.js"></script>	
			<script	src="http://50.63.128.135/~csashesi/class2015/esi-yeenuwa/Ash_transit_conductor/jquery.mobile-1.4.4.min.js"></script>

	<script>
                 var tripType;
    
                //makes an ajax call
		function syncAjax(u){
			var obj=$.ajax(
				{url:u,
				 async:false
				 }
			);
			return $.parseJSON(obj.responseText);
				
		}
                        
                        
                //sets the role of a conductor
		function changeConductor(){
		
			var idd=$("#select-conductor").val();	
			var u="http://50.63.128.135/~csashesi/class2015/esi-yeenuwa/Ash_transit_conductor/myGroup_action.php?cmd=1&id="
				+idd;
				
				var r=syncAjax(u);
		}
                
               
                //creates a list of all the reservations made for a paticular trip
                function mylsit(){
                         tripType=$("#select-trip").val();
 
                        var u="http://50.63.128.135/~csashesi/class2015/esi-yeenuwa/Ash_transit_conductor/myGroup_action.php?cmd=3&trip="+tripType;					
			var r=syncAjax(u);
			
			if(r.result==0){
				$("divStatus").text(r.message);
				return;
			}
			var i=0;
			for(i=0;i<r.bookings.length;i++){
				
                        var parent = document.getElementById('listview');
                        var listItem = document.createElement('li');
                        listItem.setAttribute('id','listitem');
			
			var name=r.bookings[i].name;
                        var id=r.bookings[i].id;
           
                        listItem.innerHTML="<a href='#pagefive' onclick='myDetails("+id+")'><h3>"+name+"</h3></a>";
                        parent.appendChild(listItem);
			
                        var list = document.getElementById('listview');
                        $(list).listview().listview("refresh");            
                    }                      
                }

               //Displays more infomation any selected user in the list
               function myDetails(id){
                    var u="http://50.63.128.135/~csashesi/class2015/esi-yeenuwa/Ash_transit_conductor/myGroup_action.php?cmd=4&pid="+id+"&trip="+tripType;
     			
			var r=syncAjax(u);
			
			if(r.result==0){
				$("divStatus").text(r.message);
				return;
			}
			var i=0;
                        var pid; var name; var phone; var t_name; var destination; var seat_no; var t_date;
			for(i=0;i<r.bookings.length;i++){
                            
                         pid=r.bookings[i].id;
                         
                        name=r.bookings[i].name;
                       
                        phone=r.bookings[i].phone;
                        t_name=r.bookings[i].t_name;
                        destination=r.bookings[i].destination;
                        seat_no=r.bookings[i].seat_no; 
                        t_date=r.bookings[i].t_date; 
                        }
                       
                        $("#name").val(name);
                        $("#date").val(t_date);
                        $("#location").val(destination);
                        $("#contact").val(phone);     
                }
  
            //updates the pick up time of all the bus stops of a trip
            function updateTime(){
                var location=$("#select-location").val();
                var u="http://50.63.128.135/~csashesi/class2015/esi-yeenuwa/Ash_transit_conductor/myGroup_action.php?cmd=2&id="+location;
                      
		var r=syncAjax(u);
                if(r.result==0){
                    
                  $("#status").fadeTo(500,1, function() { $(this).html("An error occured! Please try again later").fadeTo(5000,0,function() {location.href="#pagefour"}); })
                    return;
                }
                
               $("#status").fadeTo(500,1, function() { $(this).html("Success! Time has sucessfully been set").fadeTo(5000,0,function() {location.href="#pagetwo"}); })
}

            //updates the location of a the bus during a trip
            function updateLocation(){
    
                var curLocation=$("#cur-location").val();
     
                var u="http://50.63.128.135/~csashesi/class2015/esi-yeenuwa/Ash_transit_conductor/myGroup_action.php?cmd=5&location="+curLocation;
                        console.log(u);
		var r=syncAjax(u);
                if(r.result==0){
                    
                   $("#status").fadeTo(500,1, function() { $(this).html("An error occured! An error occured. Please try agian later.").fadeTo(5000,0,function() {location.href="#pagetwo"}); })
                    return;
                }
                
               $("#status").fadeTo(500,1, function() { $(this).html("Success! Current location successfully updated").fadeTo(5000,0,function() {location.href="#pagetwo"}); })
    
            }
            
            
            //gets values of date, time picker, inputboxes and stores it in the database by making an ajax call
	//gets values of date, time picker, inputboxes and stores it in the database by making an ajax call
					function insert_trip(){
					var tn=document.getElementById("tripname").value;
					var tt=document.getElementById("triptime").value;
					var td=document.getElementById("tripdate").value;
					var bt=document.getElementById("bustype").value;
					var ac=document.getElementById("admincapacity").value;
					var seats= ac				
					var u="http://50.63.128.135/~csashesi/class2015/esi-yeenuwa/Ash_transit_conductor/ash_transit_action.php?cmd=2&name="+tn+"&time="+tt+"&date="+td+"&bus_c="+bt+"&admin_c="+ac+"&avail_s="+seats;	
					console.log(u);
					r=syncAjax(u);	
                                        
                                          $("#statusadd").fadeTo(500,1, function() { $(this).html("Success! Trip details sucessfully added").fadeTo(5000,0,function() {location.href="#homepage"}); })
				}	
                                
               function login(){
				
						var myashid=document.getElementById("myashid").value;
						var mypword=document.getElementById("mypword").value;
						var u="http://50.63.128.135/~csashesi/class2015/esi-yeenuwa/Ash_transit_conductor/myGroup_action.php?cmd=6&myashid="+myashid+"&mypword="+mypword;
						console.log(u);
						r=syncAjax(u);
						
						var id=r.User.Ashesi_Id;
						var name=r.User.name;
						var phone=r.User.phone_number;
						var myrole=r.User.role;
						var mypassword=r.User.password;
					
					if (myashid == id && mypword == mypassword && myrole == "conductor") {
						$("#status").fadeTo(500,1, function() { $(this).html("Success! Loading Admin's Page...").fadeTo(5000,0,function() {location.href="#pageone"}); })
						$("#myashid").val("");
						 $("#mypword").val("");
					}
					//Message displayed if username or password is not correct
					else{
						$("#statusfailed").fadeTo(500,1, function() { $(this).html("Invalid username or password").fadeTo(5000,0,function() {location.href="#this"}); })
						$("#myashid").val("");
						 $("#mypword").val("");
					}
						 
				}



	</script>
</head> 
 <body>
 
        <div data-role="page" id="login" data-theme="b">	
		<!-- This is an header for the page -->
		<div data-role="header" data-position="fixed">		
				<h1>ASH TRANSPORTER</h1>
				<div data-role="navbar" data-position="fixed">
					<ul><li><a href="#" data-transition="slide" data-icon="home" data-iconpos="left">Admin login</a></li></ul>
				</div>
		</div>
		<!-- the main body, where the trip details are displayed, using input boxes and labels-->
		<div data-role="main" class="ui-content">
				<div  id="date" align="right"></div>
				<div><label for="aid">Ashesi ID</label><input type="text" id="myashid" ></div>
				<div><label for="ap">Password</label><input type="password" id="mypword" ></div>
				<div><input type="button" style="background:green; " id="login" value="Login" onclick="login()" ></div>
				<div id="status" style="color:green;" align="center"> </div>
				<div id="statusfailed" style="color:red;" align="center"> </div>
				
		</div>	
		<!-- This is a footer -->
			<div data-role="footer" data-position="fixed" >	
					<h1>Droid-Ventors@AshSoftEng2014</h1>
			</div>	
		</div>
     
         <div data-role="page" id="pageone" data-theme="b">
	              	<div data-role="header" data-position="fixed">		
				<h1>ASH TRANSIT</h1>
				<div data-role="navbar" data-position="fixed">
					<ul>	
						<li><a href="#pageone" data-transition="slide" data-icon="home" data-iconpos="left">Trip Details</a></li>
					</ul>
				</div>
			</div>
		
	                  <div role="main" class="ui-content" data-position="fixed">
                              <br><br><br><br>
                              <div align="center">
                                    <a href="#homepage" data-role="button" data-inline="true" > Add a Trip</a>
                               </div>
                              <br>
                              <div align="center">
                                    <a href="#pagefour" data-role="button" data-inline="true" > Update Trip Details</a>
                               </div>
                               <br>
                               <div align="center">
                                    <a href="#pagethree" data-role="button" data-inline="true" onclick="mylsit()"> View Reservations List</a>
                               </div>
                         </div>
					
                        <div data-role="footer" data-position="fixed">
				<h3>Droid-Ventors@AshSoftEng2014</h3>	
			</div>
	
			</div> 
     
 
  
          
      <div data-role="page" id="pagefour" data-theme="b">
	              	<div data-role="header" data-position="fixed">		
				<h1>ASH TRANSIT</h1>
				<div data-role="navbar" data-position="fixed">
					<ul>	
						<li><a href="#pageone" data-transition="slide" data-icon="home" data-iconpos="left">Trip Details</a></li>
					</ul>
				</div>
			</div>
          
          
		
	                  <div role="main" class="ui-content" data-position="fixed">
                              
         
  	
  <div data-role="collapsible">		
  <h1>Set Time</h1>	
 <div data-role="content">
     <fieldset data-role="controlgroup">
	                              
     <label for="select-location">Select Current Location</label>
     <select name="select-location" id="select-location">
      
                    <option>Select Current Location</option>
	                <option value="1">Christ the King</option>
	                <option value="2">37 Station</option>
	                <option value="3">Accra Mall</option>
                        <option value="4">Legon</option>
	                <option value="5">Atomic Round About</option>
	                <option value="6">Kwabenya</option>
                        <option value="4">Abom Juction</option>
	                <option value="5">Comet</option>
	                <option value="9">Berekuso</option>
                        <option value="10">Ashesi</option>
     </select>                                 
	</fieldset>
     
     
     
      <div align="center">
	<a href="#" data-role="button" data-inline="true" onclick="updateTime()"> Set Time</a>
      </div>
  </div>

             
    </div>
 
 
   <div data-role="collapsible">		
  <h1>Update Current Location</h1>	
 <div data-role="content">
     <fieldset data-role="controlgroup">
	                              
     <label for="cur-location">Select Current Location</label>
     <select name="cur-location" id="cur-location">
      
                    <option>Select Current Location</option>
	                <option value="Christ the King">Christ the King</option>
	                <option value="37 Station">37 Station</option>
	                <option value="Accra Mall">Accra Mall</option>
                        <option value="Legon">Legon</option>
	                <option value="Atomic Round About">Atomic Round About</option>
	                <option value="Kwabenya">Kwabenya</option>
                        <option value="Abom Juction">Abom Juction</option>
	                <option value="Comet">Comet</option>
	                <option value="Berekuso">Berekuso</option>
                        <option value="Ashesi">Ashesi</option>
     </select>                                 
	</fieldset>
     
     
     
      <div align="center">
	<a href="#pagefour" data-role="button" data-inline="true" onclick="updateLocation()">Update Location</a>
      </div>
  </div>

             
    </div>
 
	</div>
          
                   <br><br>
                  <div align="center">
                    <a href="#pageone" data-role="button" data-icon="back" data-inline="true">Back</a>
                  </div>
            <br>
           <div id="status">
           </div>
                    <div data-role="footer" data-position="fixed">
                        <h3>Droid-Ventors@AshSoftEng2014</h3>	
                    </div>
	
	</div>		
     
     
     
              <div data-role="page" id="pagefive" data-theme="b">
	              	<div data-role="header" data-position="fixed">		
				<div data-role="navbar" data-position="fixed">
					<ul>	
						<li><a href="#pageone" data-transition="slide" data-icon="home" data-iconpos="left">Trip Details</a></li>
					</ul>
				</div>
			</div>
		
	                  <div role="main" class="ui-content" data-position="fixed">
            
            
                
  <div data-role="fieldcontain">
    <label for="name">Passenger Name:</label>
    <input type="text" name="name" id="name" value=""  />
</div>
 <div data-role="fieldcontain">
    <label for="date">Trip date Date:</label>
    <input type="text" name="date" id="date" value=""  />
</div>
  <div data-role="fieldcontain">
    <label for="location">Pick up Location:</label>
    <input type="text" name="location" id="location" value=""  />
</div>
  <div data-role="fieldcontain">
    <label for="contact">Contact Number:</label>
    <input type="text" name="contact" id="contact" value=""  />
</div>
 
                              	

     
         </div>
                  
                  <br><br><br>
                  <div align="center">
                    <a href="#pagethree" data-role="button" data-icon="back" data-inline="true">Back</a>
                  </div>
					<div data-role="footer" data-position="fixed">
						<h3>Droid-Ventors@AshSoftEng2014</h3>	
					</div>
	
			</div> 
     
     
     
     
         
      <div data-role="page" id="pagethree" data-theme="b">
	              	<div data-role="header" data-position="fixed">		
				<h1>ASH TRANSIT</h1>
				<div data-role="navbar" data-position="fixed">
					<ul>	
						<li><a href="#pageone" data-transition="slide" data-icon="home" data-iconpos="left">Trip Details</a></li>
					</ul>
				</div>
			</div>
		
	                  <div role="main" class="ui-content" data-position="fixed">
            
            
            <ul data-role="listview" id="listview">
				
		<li data-role="list-divider">
                    
                </li>
				
            </ul>
                              
                              
                                <br><br>
                  <div align="center">
                    <a href="#pageone" data-role="button" data-icon="back" data-inline="true">Back</a>
                  </div>
         </div>
					
					<div data-role="footer" data-position="fixed">
						<h3>Droid-Ventors@AshSoftEng2014</h3>	
					</div>
	
			</div> 
     
     
     
     
     
	 <div data-role="page" id="pagesix" data-theme="b">
	              	<div data-role="header" data-position="fixed">		
				<h1>ASH TRANSIT</h1>
				<div data-role="navbar" data-position="fixed">
					<ul>	
						<li><a href="#pageone" data-transition="slide" data-icon="home" data-iconpos="left">Trip Details</a></li>
					</ul>
				</div>
			</div>
		
	                 <div role="main" class="ui-content">
	                    <form>
	                        <div data-role="fieldcontain" align="center">
	                             <fieldset data-role="controlgroup">
	                              
	                                 <label for="select-conductor">Select Conductor</label>
	                                 <select name="select-conductor" id="select-conductor">
	                                     <option>Select Current Location</option>
                                             <option value="1234">Anna Reimah</option>
                                             <option value="5678">Nina Pearls</option>
                                           
	                                    <!-- etc. -->
	                                 </select>
	                                 
	                            </fieldset>
	                        </div>

	                         <div align="center">
                                    <label for="submit" ></label>
                                    <input type="button" name="submit" value="Save" data-inline="true" onclick="changeConductor()"/>
	                         </div>
	   `				 </form>
                     
					</div>
					
					<div data-role="footer" data-position="fixed">
						<h3>Droid-Ventors@AshSoftEng2014</h3>	
					</div>
	
			</div> 
     
     
     
                        <div data-role="page" id="homepage" data-theme="b">	
			<div data-role="header" data-position="fixed">		
				<h1>ASH TRANSPORTER</h1>
				<div data-role="navbar" data-position="fixed">
					<ul>	
						<li><a href="#" data-transition="slide" data-icon="home" data-iconpos="left">Trip Details</a></li>
					</ul>
				</div>
			</div>
			<!--- This is the body of the page!--->
		<div data-role="main" class="ui-content">
				
				<label for="name">Set Trip name</label>
				<select name="select-conductor" id="tripname">
                                <option value="ASH-CTK">Ashesi - Christ The King</option>
                                <option value="CTK-ASH">Christ The King - AShesi</option>
                                </select>
				
				<label for="name">Set Departure Date</label>
				<input type="date" id="tripdate" >
				
				<label for="name">Set Departure time</label>
				<input type="time" id="triptime" >
				
				<label for="name">Set bus type</label>
                                <select name="select-conductor" id="bustype">
                                <option value="20">20 seater</option>
                                <option value="40">40 seater</option>
                                </select>
				
				<label for="name">Set Admin Capacity</label>
				<input type="text" id="admincapacity" >
				
				<input type="Button" id="trip_details" value="Set Trip Details" onclick="insert_trip()" >
				
		</div>	
                        
                        <br><br>
                        <div align="center" id="statusadd">   
                        </div>
		<!---This is a footer!--->
			<div data-role="footer" data-position="fixed" >	
                            <h1>Droid-Ventors@AshSoftEng2014</h1>
			</div>	
		</div>
</body>
</html>